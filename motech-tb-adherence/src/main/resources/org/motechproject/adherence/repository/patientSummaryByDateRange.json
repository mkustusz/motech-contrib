{
    "map" : "function(doc) { if (doc.type =='DosageLog') { var emitValue = { patientId: doc.patientId, treatmentCourseId: doc.treatmentCourseId, doseTakenCount: doc.doseTakenCount, idealDoseCount: doc.idealDoseCount }; emit([doc.patientId, doc.treatmentCourseId, doc.dosageDate], emitValue); } }",

    "reduce" : "function(keys, values, reReduce) { if( !reReduce) { return { patientId: values[0].patientId, treatmentCourseId: values[0].treatmentCourseId, totalDoseTakenCount : sum(values.map(function(elt){ return elt.doseTakenCount })), totalIdealDoseCount : sum(values.map(function(elt){ return elt.idealDoseCount })) } } else { return { patientId: values[0].patientId, treatmentCourseId: values[0].treatmentCourseId, totalDoseTakenCount : sum(values.map(function(elt){ return elt.totalDoseTakenCount })), totalIdealDoseCount : sum(values.map(function(elt){ return elt.totalIdealDoseCount })) } } }"
}